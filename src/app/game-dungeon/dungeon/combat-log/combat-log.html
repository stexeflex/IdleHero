<div class="log-list">
  @for (entry of VisibleEntries(); track entry) {
    <!-- SEPARATOR -->
    <separator class="ih-separator" [margin]="false"></separator>
    @if (entry.Type == "Rewards") {
      <separator class="ih-separator" [margin]="false"></separator>
    }

    <!-- LOG ENTRY -->
    <div class="log-entry">
      <!-- TIMESTAMP -->
      <span class="log-time">{{ FormatTimestamp(entry.TimestampMs) }}</span>

      @switch (entry.Type) {
        <!-- INFO -->
        @case ("Info") {
          <span class="log-info">{{ entry.Message }}</span>
        }
        <!-- REWARDS -->
        @case ("Rewards") {
          <app-icon class="log-rewards" symbol="lockedchest" size="md"></app-icon>
          <div class="log-rewards-entry">
            <div class="log-rewards-header">
              <span>Completed Stage {{ entry.Stage }}</span>
            </div>
            <div class="log-rewards-values">
              <app-gold [amount]="entry.Rewards.Gold" size="sm" fontSize="1.2rem"></app-gold>
              <span class="dot">•</span>
              <app-exp [exp]="entry.Rewards.Experience" size="sm" fontSize="1.2rem"></app-exp>
              @if (entry.Rewards.Rune) {
                <span class="dot">•</span>
                <app-rune [rune]="entry.Rewards.Rune" size="sm" fontSize="1.2rem"></app-rune>
              }
            </div>
          </div>
        }
        <!-- DAMAGE -->
        @case ("Damage") {
          @let damageLogEntry = DamageLogEntryExtended(entry);

          <div class="log-damage-entry">
            <div class="log-damage-header">
              <app-combat-actor-icon
                [Actor]="entry.Actor"
                [class]="damageLogEntry.ActorClass"
                Size="md"></app-combat-actor-icon>

              <span>{{ damageLogEntry.ActionContent }}</span>

              <app-combat-actor-icon
                [Actor]="entry.Target"
                Size="md"
                class="log-damage"></app-combat-actor-icon>

              <span class="dot">•</span>

              <span class="log-damage total-damage" [class]="damageLogEntry.ActorClass">
                {{ damageLogEntry.TotalDamage | number: "1.0-0" }}
              </span>
            </div>

            <div class="log-damage-details">
              @if (damageLogEntry.DamageDetails.length > 0) {
                <span class="log-damage" [class]="damageLogEntry.ActorClass">
                  {{ damageLogEntry.DamageDetails }}
                </span>
                @if (damageLogEntry.AdditionalDetails.length > 0) {
                  <span class="dot">•</span>
                }
              }
              @if (damageLogEntry.AdditionalDetails.length > 0) {
                @for (detail of damageLogEntry.AdditionalDetails; track $index) {
                  <span class="log-damage" [class]="detail.class">
                    {{ detail.value }}
                    @if ($index < damageLogEntry.AdditionalDetails.length - 1) {
                      <span class="dot">•</span>
                    }
                  </span>
                }
              }
            </div>

            @if (entry.Damage.length > 1) {
              <div class="log-damage-values">
                [
                @for (tag of entry.Damage; track $index) {
                  <span
                    class="log-damage"
                    [class.log-multi]="
                      entry.IsMultiHit && !tag.IsCritical && !tag.IsBleeding && !tag.IsSplash
                    "
                    [class.log-critical]="tag.IsCritical"
                    [class.log-bleed]="tag.IsBleeding"
                    [class.log-splash]="tag.IsSplash">
                    {{ tag.Amount | number: "1.0-0" }}
                    @if (!$last) {
                      <span class="dot">•</span>
                    }
                  </span>
                }
                ]
              </div>
            }
          </div>
        }
        <!-- MISS -->
        @case ("Miss") {
          <app-combat-actor-icon
            [Actor]="entry.Actor"
            Size="md"
            class="log-miss"></app-combat-actor-icon>
          <span class="log-miss">MISS</span>
        }
        <!-- HEAL -->
        @case ("Heal") {
          <app-icon combat="heartplus" size="sm" class="log-heal"></app-icon>
          <app-combat-actor-icon
            [Actor]="entry.Target"
            Size="md"
            class="log-heal"></app-combat-actor-icon>
          <span class="log-heal">+{{ entry.Amount | number: "1.0-0" }} LIFE</span>
        }
        <!-- DEATH -->
        @case ("Death") {
          <app-icon combat="hastygrave" size="sm" class="log-death"></app-icon>
          <app-combat-actor-icon
            [Actor]="entry.Actor"
            Size="md"
            class="log-death"></app-combat-actor-icon>
        }
      }
    </div>
  }
</div>
